<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Login - Delhi Waterlogging System</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="logo" onclick="location.href='index.html'">
            <img src="logo.png" alt="URRS Logo">
            <h1>Urban Rain Resilience System (URRS)</h1>
        </div>
        <nav>
            <ul id="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="live-map.html">Live Map</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="guidance.html">Safety Guidelines</a></li>
                <li><a href="warning.html">Rainfall Warnings</a></li>
                <li id="auth-link"><a href="login.html">Login / Register</a></li>
            </ul>
        </nav>
    </header>

    <div class="container" style="max-width: 480px; margin-top: 4rem;">
        <div class="card" style="box-shadow: var(--shadow-2xl);">
            <div style="text-align: center; margin-bottom: var(--spacing-xl);">
                <h2 style="color: var(--primary-blue); margin-bottom: var(--spacing-sm);">Welcome Back</h2>
                <p style="color: var(--text-secondary);">Sign in to access your account</p>
            </div>
            <form id="login-form">
                <div style="margin-bottom: var(--spacing-lg);">
                    <label>Username</label>
                    <input type="text" id="login-username" required placeholder="Enter your username">
                </div>
                <div style="margin-bottom: var(--spacing-xl);">
                    <label>Password</label>
                    <input type="password" id="login-password" required placeholder="Enter your password">
                </div>
                <button type="submit" class="btn btn-primary"
                    style="width: 100%; font-size: 1.1rem; padding: 1.1rem;">Login</button>
            </form>
            <p style="text-align: center; margin-top: var(--spacing-xl); color: var(--text-secondary);">
                No account? <a href="register.html" style="font-weight: 600;">Register here</a>
            </p>
            <div style="margin-top: 2rem; border-top: 1px solid #e2e8f0; padding-top: 1.5rem; text-align: center;">
                <p style="margin-bottom: 1rem; font-size: 0.9rem; color: #64748b;">Are you an Official?</p>
                <a href="login.html" onclick="alert('Use your official credentials to login above.')"
                    class="btn btn-outline" style="width: 100%; border-color: #64748b; color: #475569;">
                    Authority Login Portal
                </a>
            </div>
        </div>
    </div>

    <script src="navbar.js"></script>
    <script>
        document.getElementById('login-form').onsubmit = async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                if (data.user.role === 'authority') {
                    window.location.href = 'authority.html';
                } else {
                    window.location.href = 'index.html';
                }
            } else {
                showToast(data.error, "error");
            }
        };
    </script>
</body>

</html>